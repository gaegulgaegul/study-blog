# 1. 자바 8, 9, 10, 11 : 무슨 일이 일어나고 있는가?

- 자바 8이후 변경사항

    [OKKY | Java8 이후 변경사항 정리( jdk 9 ~ 13 )](https://okky.kr/article/802815)

- 자바 8
    - 특징
        - 간결한 코드, 멀티 프로세서의 쉬운 활용에 중점을 둔다.
        - 함수형 프로그래밍에서 위력을 발휘할 수 있다.
    - 추가된 주요 기능
        - 스트림 API
        - 메서드에 코드를 전달하는 기법(동작 파라미터화 → 메서드 참조, 람다 표현식)
        - 인터페이스의 디폴트 메서드
- 스트림 처리
    - 스트림
        - 한 번에 한 개씩 만들어지는 연속적인 데이터 항목들 모임
        - 이론적으로 프로그램은 입력 스트림에서 데이터를 한 개씩 읽어 들이며 출력 스트림으로 데이터를 한 개씩 기록한다.
        - 쉽게 유튜브 동영상 동작방식을 생각하면 된다.
    - 유닉스 명령어

        ```bash
        cat file1 file2  | tr "[A-Z]" "[a-z]" | sort | tail -3
        ```

        - cat → 두 파일을 연결해서 스트림 생성
        - tr → 스트림 문자를 번역(대문자 → 소문자)
        - sort → 스트림 행 정렬
        - tail -3 → 마지막 3개 행을 제공
    - 스트림 API를 이용하여 위와 같은 유닉스 명령어를 구현할 수 있다.
    - 스트림 파이프라인을 이용해서 입력 부분을 여러 CPU 코어에 할당 할 수 있다.(Thread Safe한 병렬성)
- 동작 파라미터화로 메서드에 코드 전달하기
    - 앞서 유닉스 명령어의 sort를 내림차순, 오름차순 다양한 순서로 정렬할 때, 파라미터를 제공해 정렬한다.
    - custom한 순서로 정렬하고 싶을 때, 지정하는 순서대로 정렬할 수 있도록 sort 메서드에 명령을 내려야 한다.
    - 자바 8 이전에는 Comparator  객체를 생성해 sort에 넘겨주었지만 비교하는 메서드를 만들어 전달하면 된다.(책에서 CompareUsingCustomerId)
- 병렬성과 공유 가변 데이터
    - 스트림에서 제공하는 병렬성 대신 코드의 동작 방식(코드 스타일)을 바꿔야 한다.
        - 스트림 메서드로 전달하는 코드는 다른 코드와 동시에 실행 하더라도 안전해야 한다.
        - 공유된 가변 데이터에 접근하지 않아야 한다.
- 자바 함수
    - 프로그래밍에서 함수(function)는 정적 메서드(static method)를 의미하는 용어로 사용된다.
    - 자바 8에서 함수를 새로운 값의 형식으로 추가했다.
    - 프로그래밍 언어의 핵심은 값을 바꾸는 것, 전통적인 프로그래밍 언어에서 이 값을 일급(first-class) 또는 시민이라 부른다.
    - 자바 프로그래밍 언어의 다양한 구조체(메서드, 클래스)가 값의 구조를 표현하는데 도움이 될 수 있다. 하지만 값을 전달 할 수 없다. 이와 같은 구조체는 이급 시민
    - 클래스, 메서드 등은 이급 자바 시민
    - 프로그램을 실행하는 동안(런타임 시) 전달할 수 있는 값은 일급 시민뿐
    - 자바 8 설계자들은 이급 시민을 일급 시민으로 바꿀 수 있는 기능을 추가했다.
    - 메서드와 람드를 일급 시민으로
        - 메서드 참조(메서드 레퍼런스)
            - 자바 8 이전에는 listFiles의 매개변수로 클래스, 메서드를 넘길 수 없으니 FileFilter를 구현해서 전달했지만 자바 8에서 listFiles 매개변수로 메서드를 전달한다.

            ```java
            File[] hiddenFiles = new File(".").listFiles(new FileFilter() {
            	public boolean accept(File file) {
            		return file.isHidden();
            	}
            });

            File[] hiddenFiles = new File(".").listFiles(File::isHidden);
            ```

        - 람다: 익명 함수
            - 수행할 코드를 매개변수로 전달할 수 있다.

            ```java
            File[] hiddenFiles = new File(".").listFiles((f) -> f.isHidden());
            ```

- 멀티 스레딩은 어렵다
    - 멀티 스레딩 환경을 사용할 때, synchronized를 자주 사용하지만 미묘한 버그가 발생할 수 있다.
    - 스트림 API에서는 리스트를 CPU 개수별 구역을 나눈 뒤 각각 처리하고 결과를 정리한다.
- 디폴트 메서드
    - Collections.sort는 List 인터페이스에 포함되지만 실제로 List에 포함된 적은 없다.
    - Collections.list(list, comparator)가 아니라 list.sort(comparator)를 수행하는 것이 적절하다.
    - 자바 8 이전에는 인터페이스를 업데이트 하려면 해당 인터페이스를 구현하는 모든 클래스도 업데이트 해야 했다.
    - 구현 클래스에서 구현하지 않아도 되는 메서드를 인터페이스에 추가 할 수 있는 기능
    - 메서드 본문은 구현 클래스가 아니라 인터페이스의 일부로 포함한다.
    - list.sort

    ```java
    default void sort(Comparator<? super E> c) {
    	Collections.sort(this, c);
    }
    ```

- 함수형 프로그래밍에서 가져온 다른 유용한 아이디어
    - 자바에 포함된 함수형 프로그래밍의 핵심적인 아이디어
        - 메서드와 람다를 일급값으로 사용
        - 가변 공유 상태가 없는 병렬 실행
    - Optional<T> → null을 회피하는 기법
    - 다형성, 메서드 오버라이딩 → if-then-else, switch 를 대신